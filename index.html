<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flix Hub HD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

  <!-- Icons / Ad SDK -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src='//libtl.com/sdk.js' data-zone='9731188' data-sdk='show_9731188'></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Netflix Sans','Helvetica Neue',Helvetica,Arial,sans-serif; }
    body { background-color: #000; color: #fff; max-width: 480px; margin: 0 auto; overflow-x: hidden; -webkit-font-smoothing: antialiased; }

    .loading-screen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
    .loading-logo { font-size: 48px; font-weight: 700; color: #e50914; margin-bottom: 20px; animation: pulse-loader 1.5s infinite; }
    .loading-text { color: #aaa; font-size: 18px; animation: fadeInOut 2s infinite; }
    @keyframes pulse-loader { 0%{transform:scale(1);opacity:.8}50%{transform:scale(1.1);opacity:1}100%{transform:scale(1);opacity:.8} }
    @keyframes fadeInOut { 0%,100%{opacity:.5}50%{opacity:1} }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.4s ease-in-out; }

    .header { background: linear-gradient(to bottom, rgba(0,0,0,.9), rgba(0,0,0,.7)); padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
    .logo { font-size: 28px; font-weight: 700; color: #e50914; letter-spacing: -1px; }

    .search-container { flex: 1; margin: 0 15px; position: relative; }
    .search-input { width: 100%; padding: 10px 40px 10px 15px; background: rgba(255,255,255,.1); border: 1px solid rgba(255,255,255,.2); border-radius: 20px; color: #fff; font-size: 14px; transition: .3s; }
    .search-input:focus { outline: none; background: rgba(255,255,255,.2); border-color: #e50914; }
    .search-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #aaa; cursor: pointer; font-size: 16px; }

    .slider-container { position: relative; width: 100%; height: 220px; overflow: hidden; margin-bottom: 25px; }
    .slider { display: flex; transition: transform .5s ease; height: 100%; }
    .slide { min-width: 100%; height: 100%; position: relative; cursor: pointer; }
    .slide img { width: 100%; height: 100%; object-fit: cover; }
    .slide-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,.9), transparent); padding: 20px; }
    .slide-title { font-size: 22px; font-weight: 700; margin-bottom: 8px; text-shadow: 0 2px 4px rgba(0,0,0,.5); }
    .slide-meta { font-size: 14px; color: #ddd; display: flex; align-items: center; gap: 10px; }
    .slide-rating { display: flex; align-items: center; gap: 5px; color: #ffd700; }

    .slider-indicators { position: absolute; bottom: 15px; right: 15px; display: flex; gap: 8px; }
    .indicator { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,.5); cursor: pointer; transition: .3s; }
    .indicator.active { background: #e50914; transform: scale(1.2); }

    .category-section { margin-bottom: 35px; }
    .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 15px; }
    .category-title { font-size: 20px; font-weight: 700; color: #fff; position: relative; padding-left: 15px; }
    .category-title::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 5px; height: 20px; background: #e50914; border-radius: 3px; }
    .see-all { color: #e50914; font-size: 12px; text-decoration: none; font-weight: 500; transition: opacity .3s; padding: 4px 8px; border-radius: 4px; background: rgba(229,9,20,.1); }
    .see-all:hover { opacity: .8; background: rgba(229,9,20,.2); }

    .content-slider { display: flex; overflow-x: auto; padding: 0 15px; scrollbar-width: none; gap: 12px; }
    .content-slider::-webkit-scrollbar { display: none; }

    .content-card { flex: 0 0 calc(33.33% - 8px); position: relative; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,.3); transition: .3s; cursor: pointer; }
    .content-card:hover { transform: scale(1.05); box-shadow: 0 8px 16px rgba(0,0,0,.5); }
    .content-card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
    .content-card-overlay { position: absolute; top: 8px; left: 8px; display: flex; flex-direction: column; gap: 5px; }
    .content-badge { background: rgba(0,0,0,.8); color: #fff; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; backdrop-filter: blur(5px); }
    .content-title { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,.9), transparent); padding: 30px 10px 10px; font-size: 13px; font-weight: 700; text-align: center; text-shadow: 0 1px 2px rgba(0,0,0,.5); }

    /* --- Detail Page Redesign --- */
    .detail-page { padding-top: 0; }
    .detail-backdrop { width: 100%; height: 300px; position: relative; }
    .detail-backdrop img { width: 100%; height: 100%; object-fit: cover; }
    .detail-backdrop::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, #000 20%, rgba(0,0,0,0.7) 60%, transparent 100%); }
    .detail-content { padding: 0 15px; display: flex; margin-top: -120px; position: relative; z-index: 10; align-items: flex-end; }
    .detail-poster { width: 120px; height: 180px; border-radius: 10px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); margin-right: 15px; box-shadow: 0 10px 30px rgba(0,0,0,.5); flex-shrink: 0; transition: transform 0.3s, box-shadow 0.3s; }
    .detail-poster:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(229, 9, 20, 0.5); }
    .detail-poster img { width: 100%; height: 100%; object-fit: cover; }
    .detail-info { flex: 1; min-width: 0; }
    .detail-title { font-size: 26px; font-weight: 700; margin-bottom: 12px; line-height: 1.2; text-shadow: 0 2px 5px rgba(0,0,0,0.7); }
    .detail-meta { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
    .meta-tag { background: rgba(255, 255, 255, 0.1); padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: 500; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(8px); display: flex; align-items: center; gap: 5px; }
    .meta-tag i { color: #e50914; }
    .detail-actions { margin-top: 20px; display: flex; justify-content: center; }
    .detail-bottom-content { padding: 25px 15px; }
    .detail-section { margin-bottom: 30px; }
    .detail-section-title { font-size: 20px; font-weight: 700; color: #fff; position: relative; padding-left: 15px; margin-bottom: 15px; }
    .detail-section-title::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 5px; height: 20px; background: #e50914; border-radius: 3px; }
    .detail-storyline { font-size: 14px; color: #aaa; line-height: 1.6; background: #111; padding: 15px; border-radius: 8px; }
    
    /* --- Horizontal Episode Cards --- */
    .episode-card { flex: 0 0 160px; background-color: #181818; border-radius: 10px; overflow: hidden; cursor: pointer; transition: transform 0.2s ease-in-out; }
    .episode-card:hover { transform: scale(1.05); }
    .episode-thumbnail { position: relative; width: 100%; aspect-ratio: 16/9; }
    .episode-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
    .play-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; font-size: 32px; color: white; opacity: 0; transition: opacity 0.3s; }
    .episode-card:hover .play-overlay { opacity: 1; }
    .episode-info { padding: 10px; }
    .episode-title { font-size: 13px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .cast-card { flex: 0 0 90px; text-align: center; }
    .cast-card img { width: 80px; height: 120px; border-radius: 8px; object-fit: cover; border: 2px solid #333; margin-bottom: 8px; }
    .cast-name { font-size: 12px; color: #ccc; line-height: 1.3; }
    
    .category-page-header { padding: 15px; }
    .category-page-title { font-size: 24px; font-weight: 700; }
    .content-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 0 15px 15px; }
    
    .video-player { position: fixed; inset: 0; background: #000; z-index: 1000; display: none; }
    .video-close { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,.7); color: #fff; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; z-index: 1001; transition: .3s; }
    .video-close:hover { background: rgba(229,9,20,.8); transform: scale(1.1); }
    .back-btn { position: fixed; top: 15px; left: 15px; background: rgba(0,0,0,.7); color: #fff; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 18px; cursor: pointer; z-index: 101; display: none; transition: .3s; }
    .back-btn:hover { background: rgba(229,9,20,.8); transform: scale(1.1); }
    
    .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,.85); color: #fff; padding: 10px 20px; border-radius: 6px; font-size: 14px; z-index: 2000; opacity: 0; transition: opacity .3s, transform .3s; }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
    
    .button { display: flex; justify-content: center; align-items: center; color: #fff; width: 80px; height: 80px; border-radius: 100%; background: linear-gradient(30deg, rgb(255, 0, 0) 20%, rgb(255, 0, 0) 80%); transition: all 0.3s ease-in-out 0s; box-shadow: rgba(255, 0, 0, 0.6) 0px 0px 0px 0px; animation: pulse 1.2s cubic-bezier(0.8, 0, 0, 1) 0s infinite normal none running; border: 0; cursor: pointer; }
    .button:is(:hover, :focus) { transform: scale(1.2); }
    @keyframes pulse { 100% { box-shadow: 0 0 0 45px rgba(255, 0, 0, 0); } }
  </style>
</head>
<body>
  <div class="loading-screen" id="loading-screen">
    <div class="loading-logo">Flix Hub HD</div>
    <div class="loading-text" id="loading-text">Loading...</div>
  </div>

  <button class="back-btn" id="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>

  <div id="home-page" class="page active">
    <div class="header">
      <div class="logo">Flix Hub HD</div>
      <div class="search-container">
        <input type="text" class="search-input" id="search-input" placeholder="Search..." onkeyup="searchContent()" />
        <button class="search-btn"><i class="fas fa-search"></i></button>
      </div>
    </div>
    <div class="slider-container">
      <div class="slider" id="slider"></div>
      <div class="slider-indicators" id="slider-indicators"></div>
    </div>
    <div id="categories-container"></div>
    <div id="search-results-container" style="display:none;"></div>
  </div>

  <div id="detail-page" class="page">
    <div class="detail-backdrop" id="detail-backdrop"></div>
    <div class="detail-content">
      <div class="detail-poster" id="detail-poster"></div>
      <div class="detail-info">
        <h1 class="detail-title" id="detail-title"></h1>
        <div class="detail-meta" id="detail-meta"></div>
      </div>
    </div>
    <div class="detail-actions">
        <button class="button" id="play-btn" onclick="playContent()">
            <svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="26px"><path d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z" fill="currentColor"></path></svg>
        </button>
    </div>
    <div class="detail-bottom-content">
      <div class="detail-section">
        <h3 class="detail-section-title">Storyline</h3>
        <p class="detail-storyline" id="detail-storyline"></p>
      </div>
      <div class="detail-section" id="cast-section" style="display:none;">
        <h3 class="detail-section-title">Top Billed Cast</h3>
        <div class="content-slider" id="cast-slider"></div>
      </div>
      <div class="detail-section" id="episodes-section" style="display:none;">
        <h3 class="detail-section-title">Episodes</h3>
        <div class="content-slider" id="episodes-list"></div>
      </div>
      <div class="detail-section">
        <h3 class="detail-section-title">More Like This</h3>
        <div class="content-slider" id="similar-slider"></div>
      </div>
    </div>
  </div>

  <div id="category-page" class="page">
    <div class="category-page-header"><h1 id="category-page-title" class="category-page-title"></h1></div>
    <div id="category-content-grid" class="content-grid"></div>
  </div>

  <div class="video-player" id="video-player">
    <button class="video-close" onclick="closeVideoPlayer()"><i class="fas fa-times"></i></button>
    <iframe id="iframe-player" style="width:100%;height:100%;border:none;display:none;" allowfullscreen></iframe>
    <video id="native-player" style="width:100%;height:100%;display:none;" controls autoplay></video>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDI7jwEiHavAhM99DyOy4uzFl4F1tQVjCE",
      authDomain: "popfilmhub.firebaseapp.com",
      databaseURL: "https://popfilmhub-default-rtdb.firebaseio.com",
      projectId: "popfilmhub",
      storageBucket: "popfilmhub.firebasestorage.app",
      messagingSenderId: "350843258802",
      appId: "1:350843258802:web:e67f98582eb46b6dd906ab"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let allContent = [], categories = [], currentContent = null, sliderInterval = null, currentSlide = 0, pageHistory = ['home-page'];
    let moviesCache = [], webseriesCache = [];
    let unsubscribeFns = [];
    function debounce(fn, wait=300){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), wait); }; }
    const renderAllDebounced = debounce(renderAll);

    document.addEventListener('DOMContentLoaded', () => {
      loadAndRenderInitialData();
    });

    async function loadAndRenderInitialData() {
        try {
            const [moviesSnapshot, webseriesSnapshot, categoriesSnapshot] = await Promise.all([
                database.ref('movies').once('value'),
                database.ref('webseries').once('value'),
                database.ref('categories').once('value')
            ]);
            if (moviesSnapshot.exists()) moviesSnapshot.forEach(s => moviesCache.push({ id: s.key, ...s.val() }));
            if (webseriesSnapshot.exists()) webseriesSnapshot.forEach(s => webseriesCache.push({ id: s.key, ...s.val() }));
            if (categoriesSnapshot.exists()) categoriesSnapshot.forEach(snap => { const v = snap.val(); if (typeof v === 'string') categories.push(v.trim()); });
            renderAll();
            document.getElementById('loading-screen').style.display = 'none';
            setupRealtimeListenersForUpdates();
            show_9731188().then(() => { alert('Welcome!'); });
        } catch (error) {
            console.error("Failed to load initial data:", error);
            document.getElementById('loading-text').textContent = 'Failed to load data. Please refresh.';
        }
    }

    function setupRealtimeListenersForUpdates(){
      unsubscribeFns.forEach(off => { try{off();}catch(e){} });
      unsubscribeFns = [];
      const catRef = database.ref('categories');
      const moviesRef = database.ref('movies');
      const webRef = database.ref('webseries');
      catRef.on('value', snap => {
        const temp = [];
        if (snap.exists()) snap.forEach(s => { const v = s.val(); if (typeof v === 'string') temp.push(v.trim()); });
        categories = temp;
        renderAllDebounced();
        showToast('Categories updated');
      });
      moviesRef.on('value', snap => {
        const arr = [];
        if (snap.exists()) snap.forEach(s => { const val = s.val(); if (val && typeof val==='object' && val.title) arr.push({ id: s.key, ...val }); });
        moviesCache = arr;
        renderAllDebounced();
        showToast('Movies list updated');
      });
      webRef.on('value', snap => {
        const arr = [];
        if (snap.exists()) snap.forEach(s => { const val = s.val(); if (val && typeof val==='object' && val.title) arr.push({ id: s.key, ...val }); });
        webseriesCache = arr;
        renderAllDebounced();
        showToast('Webseries list updated');
      });
    }

    function renderAll(){
      allContent = [...moviesCache, ...webseriesCache].filter(Boolean).sort((a,b)=> (b.timestamp||0)-(a.timestamp||0));
      if (!categories || categories.length === 0){
        const set = new Set();
        allContent.forEach(i => { if (i && typeof i.category==='string' && i.category.trim()) set.add(i.category.trim()); });
        categories = Array.from(set);
      }
      updateSlider();
      renderDynamicCategories();
      if (currentContent && !allContent.some(c => c.id === currentContent.id)) {
        currentContent = null;
        showPage('home-page');
      }
    }

    function showToast(msg){
      const el = document.getElementById('toast');
      if (!el) return;
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(()=>{ el.classList.remove('show'); }, 2500);
    }

    window.addEventListener('beforeunload', ()=>{ unsubscribeFns.forEach(off=>{ try{off();}catch(e){} }); });

    function createContentCard(item) {
      const card = document.createElement('div');
      card.className = 'content-card';
      const typeBadge = item.type === 'webseries' ? 'WEB' : 'MOVIE';
      card.innerHTML = `<img src="${item.poster}" alt="${item.title}" onerror="this.parentElement.style.display='none'"><div class="content-card-overlay"><span class="content-badge">${typeBadge}</span></div><div class="content-title">${item.title}</div>`;
      card.onclick = () => showDetailPage(item);
      return card;
    }

    function createCastCard(actor) {
        const card = document.createElement('div');
        card.className = 'cast-card';
        const imgSrc = actor.profile_path ? `https://image.tmdb.org/t/p/w185${actor.profile_path}` : 'https://i.imgur.com/Z2MY6Y1.png';
        card.innerHTML = `<img src="${imgSrc}" alt="${actor.name}"><div class="cast-name">${actor.name}</div>`;
        return card;
    }

    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      const isHomePage = pageId === 'home-page';
      document.getElementById('back-btn').style.display = isHomePage ? 'none' : 'block';
      if (!isHomePage && pageHistory[pageHistory.length - 1] !== pageId) {
        pageHistory.push(pageId);
      } else if (isHomePage) {
        pageHistory = ['home-page'];
      }
      window.scrollTo(0, 0);
    }

    function goBack() {
      if (pageHistory.length > 1) {
        pageHistory.pop();
        const previousPage = pageHistory[pageHistory.length - 1];
        showPage(previousPage);
      }
    }

    function showDetailPage(item) {
        currentContent = item;
        if (sliderInterval) clearInterval(sliderInterval);
        document.getElementById('detail-backdrop').innerHTML = `<img src="${item.backdrop}" alt="" onerror="this.style.display='none'">`;
        document.getElementById('detail-poster').innerHTML = `<img src="${item.poster}" alt="" onerror="this.style.display='none'">`;
        document.getElementById('detail-title').textContent = item.title;
        document.getElementById('detail-meta').innerHTML = `
            <div class="meta-tag"><i class="fas fa-calendar"></i> ${item.year || 'N/A'}</div>
            <div class="meta-tag"><i class="fas fa-star"></i> ${item.rating || 'N/A'}</div>
            <div class="meta-tag"><i class="fas fa-language"></i> ${item.language || 'N/A'}</div>`;
        document.getElementById('detail-storyline').textContent = item.storyline || '';
        const castSection = document.getElementById('cast-section');
        const castSlider = document.getElementById('cast-slider');
        if (item.cast && item.cast.length > 0) {
            castSlider.innerHTML = '';
            item.cast.forEach(actor => castSlider.appendChild(createCastCard(actor)));
            castSection.style.display = 'block';
        } else {
            castSection.style.display = 'none';
        }
        const episodesSection = document.getElementById('episodes-section');
        const episodesList = document.getElementById('episodes-list');
        if (item.type === 'webseries' && item.episodes?.length > 0) {
            episodesSection.style.display = 'block';
            episodesList.innerHTML = '';
            item.episodes.forEach(ep => {
                episodesList.innerHTML += `
                    <div class="episode-card" onclick="playEpisode('${ep.link}')">
                        <div class="episode-thumbnail">
                            <img src="${item.poster}" alt="Episode Thumbnail" onerror="this.src='https://i.imgur.com/Z2MY6Y1.png';">
                            <div class="play-overlay"><i class="fas fa-play"></i></div>
                        </div>
                        <div class="episode-info">
                            <div class="episode-title">S${ep.session} E${ep.number}</div>
                        </div>
                    </div>`;
            });
        } else {
            episodesSection.style.display = 'none';
        }
        const similarSlider = document.getElementById('similar-slider');
        similarSlider.innerHTML = '';
        const similarContent = allContent.filter(c => c.id !== item.id && c.category && item.category && c.category.trim().toLowerCase() === item.category.trim().toLowerCase()).slice(0, 10);
        similarContent.forEach(content => similarSlider.appendChild(createContentCard(content)));
        showPage('detail-page');
    }

    function showCategoryPage(categoryName) {
      document.getElementById('category-page-title').textContent = categoryName;
      const grid = document.getElementById('category-content-grid');
      grid.innerHTML = '';
      const categoryContent = allContent.filter(item => item && item.category && typeof item.category === 'string' && item.category.trim().toLowerCase() === categoryName.trim().toLowerCase());
      if (categoryContent.length > 0) {
        categoryContent.forEach(item => grid.appendChild(createContentCard(item)));
      }
      showPage('category-page');
    }

    function renderDynamicCategories() {
      const container = document.getElementById('categories-container');
      container.innerHTML = '';
      categories.forEach(categoryName => {
        const categoryContent = allContent.filter(item => item && item.category && typeof item.category === 'string' && item.category.trim().toLowerCase() === categoryName.trim().toLowerCase());
        if (categoryContent.length === 0) return;
        const section = document.createElement('div');
        section.className = 'category-section';
        section.innerHTML = `<div class="category-header"><h2 class="category-title">${categoryName}</h2><a href="#" class="see-all">See All</a></div><div class="content-slider"></div>`;
        const slider = section.querySelector('.content-slider');
        categoryContent.slice(0, 10).forEach(item => slider.appendChild(createContentCard(item)));
        section.querySelector('.see-all').onclick = (e) => { e.preventDefault(); showCategoryPage(categoryName); };
        container.appendChild(section);
      });
    }

    function updateSlider() {
      const slider = document.getElementById('slider'), indicators = document.getElementById('slider-indicators'), sliderContainer = document.querySelector('.slider-container');
      slider.innerHTML = ''; indicators.innerHTML = '';
      const sliderItems = allContent.filter(item => item.slider === 'on').slice(0, 5);
      if (sliderItems.length === 0) {
          sliderContainer.style.display = 'none';
          if (sliderInterval) clearInterval(sliderInterval);
          return;
      }
      sliderContainer.style.display = 'block';
      sliderItems.forEach((item, index) => {
        const slide = document.createElement('div');
        slide.className = 'slide';
        slide.innerHTML = `<img src="${item.backdrop}" alt="" onerror="this.style.display='none'"><div class="slide-overlay"><div class="slide-title">${item.title}</div><div class="slide-meta"><span>${item.year || ''}</span><span class="slide-rating"><i class="fas fa-star"></i> ${item.rating || ''}</span></div></div>`;
        slide.onclick = () => showDetailPage(item);
        slider.appendChild(slide);
        const indicator = document.createElement('div');
        indicator.className = `indicator ${index === 0 ? 'active' : ''}`;
        indicator.onclick = () => goToSlide(index);
        indicators.appendChild(indicator);
      });
      startSlider();
    }

    function goToSlide(index) {
      currentSlide = index;
      document.getElementById('slider').style.transform = `translateX(-${currentSlide * 100}%)`;
      document.querySelectorAll('.indicator').forEach((ind, i) => ind.classList.toggle('active', i === currentSlide));
    }

    function startSlider() {
      if (sliderInterval) clearInterval(sliderInterval);
      sliderInterval = setInterval(() => {
        const slides = document.querySelectorAll('#slider .slide'); if (slides.length === 0) return;
        currentSlide = (currentSlide + 1) % slides.length;
        goToSlide(currentSlide);
      }, 5000);
    }

    function openVideoPlayer(url) {
        const playerContainer = document.getElementById('video-player');
        const iframePlayer = document.getElementById('iframe-player');
        const nativePlayer = document.getElementById('native-player');
        iframePlayer.style.display = 'none';
        nativePlayer.style.display = 'none';
        
        const directFileExtensions = ['.mkv', '.mp4', '.webm', '.mov', '.avi', '.flv', '.m3u8', '.ts'];
        const directFileDomains = ['pixeldrain.dev/api/file', 'ftpbd.net', 'ydns.eu', 'discoveryftp.net', 'sarail.net'];
        
        const isDirectFile = directFileExtensions.some(ext => url.toLowerCase().includes(ext)) || 
                           directFileDomains.some(domain => url.includes(domain));

        if (isDirectFile) {
            nativePlayer.src = url;
            nativePlayer.style.display = 'block';
        } else {
            iframePlayer.src = url;
            iframePlayer.style.display = 'block';
        }
        playerContainer.style.display = 'block';
    }


    function closeVideoPlayer() {
      const playerContainer = document.getElementById('video-player');
      const iframePlayer = document.getElementById('iframe-player');
      const nativePlayer = document.getElementById('native-player');
      playerContainer.style.display = 'none';
      iframePlayer.src = 'about:blank';
      if (!nativePlayer.paused) { nativePlayer.pause(); }
      nativePlayer.src = '';
      nativePlayer.removeAttribute('src');
      nativePlayer.load();
    }

    function playContent() {
      show_9731188().then(() => {
        if (!currentContent) return;
        let videoUrl = (currentContent.type === 'movie') ? currentContent.link : currentContent.episodes?.[0]?.link;
        if (videoUrl) openVideoPlayer(videoUrl);
        else alert('No content to play');
      });
    }

    function playEpisode(link) {
      show_9731188().then(() => {
        if (link) openVideoPlayer(link);
        else alert('Link is missing.');
      });
    }

    function searchContent() {
      const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
      const categoriesContainer = document.getElementById('categories-container');
      const searchContainer = document.getElementById('search-results-container');
      if (!searchTerm) {
        searchContainer.style.display = 'none'; categoriesContainer.style.display = 'block'; return;
      }
      const filteredContent = allContent.filter(item => (item.title||'').toLowerCase().includes(searchTerm));
      searchContainer.innerHTML = '';
      const section = document.createElement('div');
      section.className = 'category-section';
      section.innerHTML = `<div class="category-header"><h2 class="category-title">Search Results</h2></div><div class="content-grid"></div>`;
      const grid = section.querySelector('.content-grid');
      if (filteredContent.length > 0) {
        filteredContent.forEach(item => grid.appendChild(createContentCard(item)));
      } else {
        grid.innerHTML = `<p style="padding: 20px 15px; color: #aaa; grid-column: 1 / -1; text-align: center;">No results found for "${searchTerm}"</p>`;
      }
      searchContainer.appendChild(section);
      categoriesContainer.style.display = 'none';
      searchContainer.style.display = 'block';
    }
  </script>
</body>
</html>
