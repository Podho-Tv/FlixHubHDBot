<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flix Hub HD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

  <!-- Icons / Ad SDK -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  
  <script src='//libtl.com/sdk.js' data-zone='9731188' data-sdk='show_9731188'></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Netflix Sans','Helvetica Neue',Helvetica,Arial,sans-serif; }
    body { background-color: #000; color: #fff; max-width: 480px; margin: 0 auto; overflow-x: hidden; -webkit-font-smoothing: antialiased; }

    .loading-screen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
    .loading-text { color: #aaa; font-size: 18px; animation: fadeInOut 2s infinite; margin-top: 20px; }
    @keyframes fadeInOut { 0%,100%{opacity:.5}50%{opacity:1} }
    
    .loader { display: flex; align-items: center; position: relative; }
    .loader svg { margin: 0 2px; width: 40px; height: 64px; }
    .absolute { position: absolute; }
    .inline-block { display: inline-block; }
    .w-2 { width: 0.5em; }
    .dash { animation: dashArray 2s ease-in-out infinite, dashOffset 2s linear infinite; }
    .spin { animation: spinDashArray 2s ease-in-out infinite, spin 8s ease-in-out infinite, dashOffset 2s linear infinite; transform-origin: center; }
    @keyframes dashArray { 0% { stroke-dasharray: 0 1 359 0; } 50% { stroke-dasharray: 0 359 1 0; } 100% { stroke-dasharray: 359 1 0 0; } }
    @keyframes spinDashArray { 0% { stroke-dasharray: 270 90; } 50% { stroke-dasharray: 0 360; } 100% { stroke-dasharray: 270 90; } }
    @keyframes dashOffset { 0% { stroke-dashoffset: 365; } 100% { stroke-dashoffset: 5; } }
    @keyframes spin { 0% { transform: rotate(0deg); } 12.5%, 25% { transform: rotate(270deg); } 37.5%, 50% { transform: rotate(540deg); } 62.5%, 75% { transform: rotate(810deg); } 87.5%, 100% { transform: rotate(1080deg); } }
    .gradient-b { stroke: url(#b); }
    .gradient-c { stroke: url(#c); }
    .gradient-d { stroke: url(#d); }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.4s ease-in-out; }

    .header { background: linear-gradient(to bottom, rgba(0,0,0,.9), rgba(0,0,0,.7)); padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
    .logo { font-size: 28px; font-weight: 700; color: #e50914; letter-spacing: -1px; }

    .search { display: inline-block; position: relative; flex: 1; margin: 0 15px; }
    .search input[type="text"] { width: 100%; padding: 10px; border: none; border-radius: 20px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); padding-right: 70px; }
    .search button[type="submit"] { background-color: #4e99e9; border: none; color: #fff; cursor: pointer; padding: 10px 20px; border-radius: 20px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); position: absolute; top: 0; right: 0; height: 100%; transition: .9s ease; }
    .search button[type="submit"]:hover { transform: scale(1.1); color: rgb(255, 255, 255); background-color: blue; }

    .menu-btn { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; padding: 0 10px; }
    .sidebar { height: 100%; width: 260px; position: fixed; z-index: 1200; top: 0; right: 0; left: auto; background-color: #111; overflow-x: hidden; transition: transform 0.3s ease-in-out; transform: translateX(100%); padding-top: 60px; }
    .sidebar.active { transform: translateX(0); }
    .sidebar-header { padding: 10px 20px; text-align: center; }
    .sidebar-logo { font-size: 32px; font-weight: 700; color: #e50914; text-decoration: none; }
    .sidebar-nav { border-top: 1px solid #222; margin-top: 20px; }
    .sidebar a { padding: 12px 20px; text-decoration: none; font-size: 16px; color: #aaa; display: block; transition: 0.3s; border-right: 3px solid transparent; border-left: none; }
    .sidebar a:hover { color: #fff; background-color: #e50914; border-right: 3px solid #fff; border-left: none; }
    .sidebar-nav h3 { padding: 15px 20px 5px; font-size: 12px; text-transform: uppercase; color: #555; }
    .overlay { position: fixed; display: none; width: 100%; height: 100%; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.7); z-index: 1100; cursor: pointer; }
    .overlay.active { display: block; }

    .slider-container { position: relative; width: 100%; height: 220px; overflow: hidden; margin-bottom: 25px; }
    .slider { display: flex; transition: transform .5s ease; height: 100%; }
    .slide { min-width: 100%; height: 100%; position: relative; cursor: pointer; }
    .slide img { width: 100%; height: 100%; object-fit: cover; }
    .slide-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,.9), transparent); padding: 20px; }
    .slide-title { font-size: 22px; font-weight: 700; margin-bottom: 8px; text-shadow: 0 2px 4px rgba(0,0,0,.5); }
    .slide-meta { font-size: 14px; color: #ddd; display: flex; align-items: center; gap: 10px; }
    .slide-rating { display: flex; align-items: center; gap: 5px; color: #ffd700; }
    .slider-indicators { position: absolute; bottom: 15px; right: 15px; display: flex; gap: 8px; }
    .indicator { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,.5); cursor: pointer; transition: .3s; }
    .indicator.active { background: #e50914; transform: scale(1.2); }
    .category-section { margin-bottom: 35px; }
    .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 15px; }
    .category-title { font-size: 20px; font-weight: 700; color: #fff; position: relative; padding-left: 15px; }
    .category-title::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 5px; height: 20px; background: #e50914; border-radius: 3px; }
    .see-all { color: #e50914; font-size: 12px; text-decoration: none; font-weight: 500; transition: opacity .3s; padding: 4px 8px; border-radius: 4px; background: rgba(229,9,20,.1); }
    .see-all:hover { opacity: .8; background: rgba(229,9,20,.2); }
    .content-slider { display: flex; overflow-x: auto; padding: 0 15px; scrollbar-width: none; gap: 12px; }
    .content-slider::-webkit-scrollbar { display: none; }
    .content-card { flex: 0 0 calc(33.33% - 8px); position: relative; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,.3); transition: .3s; cursor: pointer; }
    .content-card:hover { transform: scale(1.05); box-shadow: 0 8px 16px rgba(0,0,0,.5); }
    .content-card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
    .content-card-overlay { position: absolute; top: 8px; left: 8px; display: flex; flex-direction: column; gap: 5px; }
    .content-badge { background: rgba(0,0,0,.8); color: #fff; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; backdrop-filter: blur(5px); }
    .content-title { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,.9), transparent); padding: 30px 10px 10px; font-size: 13px; font-weight: 700; text-align: center; text-shadow: 0 1px 2px rgba(0,0,0,.5); }
    .livetv-card { flex: 0 0 80px; text-align: center; }
    .livetv-card img { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 2px solid #333; margin-bottom: 8px; cursor: pointer; transition: transform 0.2s; }
    .livetv-card img:hover { transform: scale(1.1); }
    .livetv-title { display: none; }
    .detail-page { padding-top: 0; }
    .detail-backdrop { width: 100%; height: 300px; position: relative; }
    .detail-backdrop img { width: 100%; height: 100%; object-fit: cover; }
    .detail-backdrop::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, #000 20%, rgba(0,0,0,0.7) 60%, transparent 100%); }
    .detail-content { padding: 0 15px; display: flex; margin-top: -120px; position: relative; z-index: 10; align-items: flex-end; }
    .detail-poster { width: 120px; height: 180px; border-radius: 10px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2); margin-right: 15px; box-shadow: 0 10px 30px rgba(0,0,0,.5); flex-shrink: 0; transition: transform 0.3s, box-shadow 0.3s; }
    .detail-poster:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(229, 9, 20, 0.5); }
    .detail-poster img { width: 100%; height: 100%; object-fit: cover; }
    .detail-info { flex: 1; min-width: 0; }
    .detail-title { font-size: 26px; font-weight: 700; margin-bottom: 12px; line-height: 1.2; text-shadow: 0 2px 5px rgba(0,0,0,0.7); }
    .detail-meta { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
    .meta-tag { background: rgba(255, 255, 255, 0.1); padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: 500; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(8px); display: flex; align-items: center; gap: 5px; }
    .meta-tag i { color: #e50914; }
    .detail-actions { margin-top: 20px; display: flex; justify-content: center; }
    .detail-bottom-content { padding: 25px 15px; }
    .detail-section { margin-bottom: 30px; }
    .detail-section-title { font-size: 20px; font-weight: 700; color: #fff; position: relative; padding-left: 15px; margin-bottom: 15px; }
    .detail-section-title::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 5px; height: 20px; background: #e50914; border-radius: 3px; }
    .detail-storyline { font-size: 14px; color: #aaa; line-height: 1.6; background: #111; padding: 15px; border-radius: 8px; }
    .episode-card { flex: 0 0 160px; background-color: #181818; border-radius: 10px; overflow: hidden; cursor: pointer; transition: transform 0.2s ease-in-out; }
    .episode-card:hover { transform: scale(1.05); }
    .episode-thumbnail { position: relative; width: 100%; aspect-ratio: 16/9; }
    .episode-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
    .play-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; font-size: 32px; color: white; opacity: 0; transition: opacity 0.3s; }
    .episode-card:hover .play-overlay { opacity: 1; }
    .episode-info { padding: 10px; }
    .episode-title { font-size: 13px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .cast-card { flex: 0 0 90px; text-align: center; }
    .cast-card img { width: 80px; height: 120px; border-radius: 8px; object-fit: cover; border: 2px solid #333; margin-bottom: 8px; }
    .cast-name { font-size: 12px; color: #ccc; line-height: 1.3; }
    .category-page-header { padding: 15px; }
    .category-page-title { font-size: 24px; font-weight: 700; }
    .content-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 0 15px 15px; }
    .video-player { position: fixed; inset: 0; background: #000; z-index: 1000; display: none; }
    .video-close { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,.7); color: #fff; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; z-index: 1001; transition: .3s; }
    .video-close:hover { background: rgba(229,9,20,.8); transform: scale(1.1); }
    .back-btn { position: fixed; top: 15px; left: 15px; background: rgba(0,0,0,.7); color: #fff; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 18px; cursor: pointer; z-index: 101; display: none; transition: .3s; }
    .back-btn:hover { background: rgba(229,9,20,.8); transform: scale(1.1); }
    .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,.85); color: #fff; padding: 10px 20px; border-radius: 6px; font-size: 14px; z-index: 2000; opacity: 0; transition: opacity .3s, transform .3s; }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
    .button { display: flex; justify-content: center; align-items: center; color: #fff; width: 80px; height: 80px; border-radius: 100%; background: linear-gradient(30deg, rgb(255, 0, 0) 20%, rgb(255, 0, 0) 80%); transition: all 0.3s ease-in-out 0s; box-shadow: rgba(255, 0, 0, 0.6) 0px 0px 0px 0px; animation: pulse 1.2s cubic-bezier(0.8, 0, 0, 1) 0s infinite normal none running; border: 0; cursor: pointer; }
    .button:is(:hover, :focus) { transform: scale(1.2); }
    @keyframes pulse { 100% { box-shadow: 0 0 0 45px rgba(255, 0, 0, 0); } }

    #livetv-content-grid { grid-template-columns: repeat(4, 1fr); gap: 20px; }
    .livetv-channel-card {
        aspect-ratio: 1 / 1;
        background-color: #fff;
        border-radius: 50%;
        padding: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        cursor: pointer;
        transition: transform 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .livetv-channel-card:hover { transform: scale(1.1); }
    .livetv-channel-card img { width: 100%; height: 100%; object-fit: contain; }

    #livetv-player-container {
        position: relative;
        width: 100%;
        padding-top: 56.25%; /* 16:9 Aspect Ratio */
        background-color: #000;
    }
    #livetv-iframe-player {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        border: none;
    }
    #current-channel-info {
        display: flex;
        align-items: center;
        padding: 15px;
        background-color: #111;
        border-bottom: 1px solid #222;
    }
    #current-channel-logo {
        width: 60px; height: 60px;
        border-radius: 50%;
        margin-right: 15px;
        object-fit: contain;
        background-color: #fff;
        padding: 5px;
        flex-shrink: 0;
    }
    #current-channel-title { font-size: 20px; font-weight: 700; }
    #other-channels-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        padding: 15px;
    }
  </style>
</head>
<body>
  <div id="sidebar-overlay" class="overlay" onclick="toggleSidebar()"></div>
  <div id="sidebar-menu" class="sidebar">
    <div class="sidebar-header">
      <a href="#" class="sidebar-logo" onclick="showPage('home-page'); toggleSidebar();">Flix Hub HD</a>
    </div>
    <div id="sidebar-nav-container" class="sidebar-nav">
    </div>
  </div>

  <div class="loading-screen" id="loading-screen">
    <div class="loader">
      <svg class="absolute" width="0" height="0">
        <defs>
          <linearGradient id="b" x1="0" y1="62" x2="0" y2="2" gradientUnits="userSpaceOnUse"><stop stop-color="#973BED"></stop><stop offset="1" stop-color="#007CFF"></stop></linearGradient>
          <linearGradient id="c" x1="0" y1="64" x2="0" y2="0" gradientUnits="userSpaceOnUse"><stop stop-color="#FFC800"></stop><stop offset="1" stop-color="#F0F"></stop><animateTransform attributeName="gradientTransform" type="rotate" values="0 32 32;-270 32 32;-540 32 32;-810 32 32;-1080 32 32" dur="8s" keyTimes="0;0.125;0.25;0.375;0.5;0.625;0.75;0.875;1" repeatCount="indefinite"></animateTransform></linearGradient>
          <linearGradient id="d" x1="0" y1="62" x2="0" y2="2" gradientUnits="userSpaceOnUse"><stop stop-color="#00E0ED"></stop><stop offset="1" stop-color="#00DA72"></stop></linearGradient>
        </defs>
      </svg>
      <svg viewBox="0 0 44 54" fill="none" xmlns="http://www.w3.org/2000/svg"><path pathLength="360" d="M10 5 H30 V15 H15 V25 H25 V35 H15 V50" class="dash gradient-b" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      <svg viewBox="0 0 44 54" fill="none" xmlns="http://www.w3.org/2000/svg"><path pathLength="360" d="M10 5 V45 H30" class="dash gradient-c" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      <svg viewBox="0 0 44 54" fill="none" xmlns="http://www.w3.org/2000/svg"><path pathLength="360" d="M22 5 V45" class="dash gradient-d" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      <svg viewBox="0 0 44 54" fill="none" xmlns="http://www.w3.org/2000/svg"><path pathLength="360" d="M10 5 L34 45 M34 5 L10 45" class="dash gradient-b" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      <svg viewBox="0 0 44 54" fill="none" xmlns="http://www.w3.org/2000/svg"><path pathLength="360" d="M10 5 V45 M30 5 V45 M10 25 H30" class="dash gradient-c" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      <svg viewBox="0 0 44 54" fill="none" xmlns="http://www.w3.org/2000/svg"><path pathLength="360" d="M10 5 V35 Q22 45 34 35 V5" class="dash gradient-d" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      <svg viewBox="0 0 44 54" fill="none" xmlns="http://www.w3.org/2000/svg"><path pathLength="360" d="M10 5 V45 H20 Q30 45 30 35 Q30 25 20 25 H30 Q40 25 40 15 Q40 5 30 5 H10" class="dash gradient-b" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      <svg viewBox="0 0 44 54" fill="none" xmlns="http://www.w3.org/2000/svg"><path pathLength="360" d="M10 5 V45 M30 5 V45 M10 25 H30" class="dash gradient-c" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      <svg viewBox="0 0 44 54" fill="none" xmlns="http://www.w3.org/2000/svg"><path pathLength="360" d="M10 5 V45 H20 Q30 45 30 25 Q30 5 20 5 H10" class="dash gradient-d" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      <div class="w-2"></div>
    </div>
    <div class="loading-text" id="loading-text">Loading...</div>
  </div>

  <button class="back-btn" id="back-btn" onclick="goBack()"><i class="fas fa-arrow-left"></i></button>

  <div id="home-page" class="page active">
    <div class="header">
      <div class="logo">Flix Hub HD</div>
      <div class="search">
        <input placeholder="Search..." type="text" id="search-input" onkeyup="searchContent()">
        <button type="submit" onclick="searchContent()">Go</button>
      </div>
      <button class="menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    </div>
    
    <div id="main-content-container">
        <div class="slider-container">
          <div class="slider" id="slider"></div>
          <div class="slider-indicators" id="slider-indicators"></div>
        </div>
        <div id="categories-container"></div>
    </div>

    <div id="search-results-container" style="display:none;"></div>
  </div>

  <div id="detail-page" class="page">
    <div class="detail-backdrop" id="detail-backdrop"></div>
    <div class="detail-content">
      <div class="detail-poster" id="detail-poster"></div>
      <div class="detail-info">
        <h1 class="detail-title" id="detail-title"></h1>
        <div class="detail-meta" id="detail-meta"></div>
      </div>
    </div>
    <div class="detail-actions">
        <button class="button" id="play-btn" onclick="playContent()">
            <svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="26px"><path d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z" fill="currentColor"></path></svg>
        </button>
    </div>
    <div class="detail-bottom-content">
      <div class="detail-section" id="episodes-section" style="display:none;">
        <h3 class="detail-section-title">Episodes</h3>
        <div class="content-slider" id="episodes-list"></div>
      </div>
      <div class="detail-section">
        <h3 class="detail-section-title">Storyline</h3>
        <p class="detail-storyline" id="detail-storyline"></p>
      </div>
      <div class="detail-section" id="cast-section" style="display:none;">
        <h3 class="detail-section-title">Top Billed Cast</h3>
        <div class="content-slider" id="cast-slider"></div>
      </div>
      <div class="detail-section">
        <h3 class="detail-section-title">More Like This</h3>
        <div class="content-slider" id="similar-slider"></div>
      </div>
    </div>
  </div>

  <div id="category-page" class="page">
    <div class="category-page-header"><h1 id="category-page-title" class="category-page-title"></h1></div>
    <div id="category-content-grid" class="content-grid"></div>
  </div>
  
  <div id="content-list-page" class="page">
    <div class="category-page-header"><h1 id="content-list-title" class="category-page-title"></h1></div>
    <div id="content-list-grid" class="content-grid"></div>
  </div>

  <div id="livetv-page" class="page">
    <div class="category-page-header"><h1 class="category-page-title">Live TV Channels</h1></div>
    <div id="livetv-content-grid" class="content-grid"></div>
  </div>
  
  <div id="livetv-player-page" class="page">
      <div id="livetv-player-container">
          <iframe id="livetv-iframe-player" allowfullscreen></iframe>
      </div>
      <div id="current-channel-info">
          <img id="current-channel-logo" src="">
          <h2 id="current-channel-title"></h2>
      </div>
      <div class="detail-section">
          <h3 class="detail-section-title" style="padding-left:15px">More Channels</h3>
          <div id="other-channels-grid" class="content-grid"></div>
      </div>
  </div>

  <div class="video-player" id="video-player">
    <button class="video-close" onclick="closeVideoPlayer()"><i class="fas fa-times"></i></button>
    <iframe id="iframe-player" style="width:100%;height:100%;border:none;display:none;" allowfullscreen></iframe>
    <video id="native-player" style="width:100%;height:100%;display:none;" controls autoplay></video>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAO3DL6Dmscz95p5s6F6f36ytMYTiqDVYg",
      authDomain: "flix-hubhd.firebaseapp.com",
      databaseURL: "https://flix-hubhd-default-rtdb.firebaseio.com",
      projectId: "flix-hubhd",
      storageBucket: "flix-hubhd.firebasestorage.app",
      messagingSenderId: "604284029925",
      appId: "1:604284029925:web:d14c1c4a1c4aa827d67d0c",
      measurementId: "G-P7G2KMJ4ZY"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let allContent = [], categories = [], currentContent = null, sliderInterval = null, currentSlide = 0, pageHistory = ['home-page'];
    let moviesCache = [], webseriesCache = [], liveTVCache = [];
    
    function debounce(fn, wait = 300) { let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), wait); }; }
    const renderAllDebounced = debounce(renderAll);

    document.addEventListener('DOMContentLoaded', () => {
        attachRealtimeListeners();
    });

    function attachRealtimeListeners() {
        let dataLoaded = { movies: false, series: false, tv: false, categories: false };
        let initialLoadComplete = false;

        function checkInitialLoad() {
            if (initialLoadComplete) return;
            if (Object.values(dataLoaded).every(status => status === true)) {
                initialLoadComplete = true;
                document.getElementById('loading-screen').style.display = 'none';
                show_9731188().then(() => { alert('Welcome!'); });
            }
        }

        database.ref('movies').on('value', snap => {
            moviesCache = [];
            if (snap.exists()) snap.forEach(s => { const val = s.val(); if (val && typeof val === 'object' && val.title) moviesCache.push({ id: s.key, ...val }); });
            if (!dataLoaded.movies) { dataLoaded.movies = true; checkInitialLoad(); }
            renderAllDebounced();
            showToast('Movies list updated');
        });

        database.ref('webseries').on('value', snap => {
            webseriesCache = [];
            if (snap.exists()) snap.forEach(s => { const val = s.val(); if (val && typeof val === 'object' && val.title) webseriesCache.push({ id: s.key, ...val }); });
            if (!dataLoaded.series) { dataLoaded.series = true; checkInitialLoad(); }
            renderAllDebounced();
            showToast('Webseries list updated');
        });
        
        database.ref('categories').on('value', snap => {
            categories = [];
            if (snap.exists()) snap.forEach(s => { const v = s.val(); if (typeof v === 'string') categories.push(v.trim()); });
            if (!dataLoaded.categories) { dataLoaded.categories = true; checkInitialLoad(); }
            renderSidebarMenu();
            renderAllDebounced();
        });

        database.ref('livetv').on('value', snap => {
            liveTVCache = [];
            if (snap.exists()) {
                snap.forEach(s => { liveTVCache.push({ id: s.key, ...s.val() }); });
            }
            if (!dataLoaded.tv) { dataLoaded.tv = true; checkInitialLoad(); }
            showToast('Live TV updated');
        });
    }

    function renderAll(){
      allContent = [...moviesCache, ...webseriesCache].filter(Boolean).sort((a,b)=> (b.timestamp||0)-(a.timestamp||0));
      updateSlider();
      renderDynamicCategories();
      
      if (currentContent && !allContent.some(c => c.id === currentContent.id)) {
        currentContent = null;
        showPage('home-page');
      }
    }
    
    function showToast(msg, type = 'success'){
      const el = document.getElementById('toast');
      if (!el) return;
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(()=>{ el.classList.remove('show'); }, 2500);
    }

    function createContentCard(item) {
      const card = document.createElement('div');
      card.className = 'content-card';
      const typeBadge = item.type === 'webseries' ? 'WEB' : 'MOVIE';
      card.innerHTML = `<img src="${item.poster}" alt="${item.title}" onerror="this.parentElement.style.display='none'"><div class="content-card-overlay"><span class="content-badge">${typeBadge}</span></div><div class="content-title">${item.title}</div>`;
      card.onclick = () => showDetailPage(item);
      return card;
    }

    function createCastCard(actor) {
        const card = document.createElement('div');
        card.className = 'cast-card';
        const imgSrc = actor.profile_path ? `https://image.tmdb.org/t/p/w185${actor.profile_path}` : 'https://i.imgur.com/Z2MY6Y1.png';
        card.innerHTML = `<img src="${imgSrc}" alt="${actor.name}"><div class="cast-name">${actor.name}</div>`;
        return card;
    }

    function createLiveTVGridCard(channel) {
        const card = document.createElement('div');
        card.className = 'livetv-channel-card';
        card.innerHTML = `<img src="${channel.poster}" alt="${channel.title}" onerror="this.parentElement.style.display='none'">`;
        card.onclick = () => showLiveTVPlayerPage(channel);
        return card;
    }

    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      const isHomePage = pageId === 'home-page';
      document.getElementById('back-btn').style.display = isHomePage ? 'none' : 'block';
      if (!isHomePage && pageHistory[pageHistory.length - 1] !== pageId) {
        pageHistory.push(pageId);
      } else if (isHomePage) {
        pageHistory = ['home-page'];
      }
      window.scrollTo(0, 0);
    }

    function goBack() {
      if (pageHistory.length > 1) {
        const currentPage = pageHistory.pop();
        if(currentPage === 'livetv-player-page') {
            const player = document.getElementById('livetv-iframe-player');
            player.src = 'about:blank';
        }
        const previousPage = pageHistory[pageHistory.length - 1];
        showPage(previousPage);
      }
    }

    function showDetailPage(item) {
        currentContent = item;
        if (sliderInterval) clearInterval(sliderInterval);
        document.getElementById('detail-backdrop').innerHTML = `<img src="${item.backdrop}" alt="" onerror="this.style.display='none'">`;
        document.getElementById('detail-poster').innerHTML = `<img src="${item.poster}" alt="" onerror="this.style.display='none'">`;
        document.getElementById('detail-title').textContent = item.title;
        document.getElementById('detail-meta').innerHTML = `<div class="meta-tag"><i class="fas fa-calendar"></i> ${item.year || 'N/A'}</div><div class="meta-tag"><i class="fas fa-star"></i> ${item.rating || 'N/A'}</div><div class="meta-tag"><i class="fas fa-language"></i> ${item.language || 'N/A'}</div>`;
        document.getElementById('detail-storyline').textContent = item.storyline || '';
        const castSection = document.getElementById('cast-section');
        const castSlider = document.getElementById('cast-slider');
        if (item.cast && item.cast.length > 0) {
            castSlider.innerHTML = '';
            item.cast.forEach(actor => castSlider.appendChild(createCastCard(actor)));
            castSection.style.display = 'block';
        } else {
            castSection.style.display = 'none';
        }
        const episodesSection = document.getElementById('episodes-section');
        const episodesList = document.getElementById('episodes-list');
        if (item.type === 'webseries' && item.episodes?.length > 0) {
            episodesSection.style.display = 'block';
            episodesList.innerHTML = '';
            item.episodes.forEach(ep => {
                episodesList.innerHTML += `<div class="episode-card" onclick="playEpisode('${ep.link}')"><div class="episode-thumbnail"><img src="${item.poster}" alt="Episode Thumbnail" onerror="this.src='https://i.imgur.com/Z2MY6Y1.png';"><div class="play-overlay"><i class="fas fa-play"></i></div></div><div class="episode-info"><div class="episode-title">S${ep.session} E${ep.number}</div></div></div>`;
            });
        } else {
            episodesSection.style.display = 'none';
        }
        const similarSlider = document.getElementById('similar-slider');
        similarSlider.innerHTML = '';
        const similarContent = allContent.filter(c => c.id !== item.id && c.category && item.category && c.category.trim().toLowerCase() === item.category.trim().toLowerCase()).slice(0, 10);
        similarContent.forEach(content => similarSlider.appendChild(createContentCard(content)));
        showPage('detail-page');
    }

    function showCategoryPage(categoryName) {
      document.getElementById('category-page-title').textContent = categoryName;
      const grid = document.getElementById('category-content-grid');
      grid.innerHTML = '';
      const categoryContent = allContent.filter(item => item && item.category && typeof item.category === 'string' && item.category.trim().toLowerCase() === categoryName.trim().toLowerCase());
      if (categoryContent.length > 0) {
        categoryContent.forEach(item => grid.appendChild(createContentCard(item)));
      }
      showPage('category-page');
    }

    function showLiveTVPage() {
        const grid = document.getElementById('livetv-content-grid');
        grid.innerHTML = '';
        if (liveTVCache && liveTVCache.length > 0) {
            liveTVCache.forEach(channel => {
                grid.appendChild(createLiveTVGridCard(channel));
            });
        }
        showPage('livetv-page');
    }
    
    function renderDynamicCategories() {
      const container = document.getElementById('categories-container');
      container.innerHTML = '';
      const uniqueCategories = [...new Set(categories)];
      uniqueCategories.forEach(categoryName => {
        const categoryContent = allContent.filter(item => item && item.category && typeof item.category === 'string' && item.category.trim().toLowerCase() === categoryName.trim().toLowerCase());
        if (categoryContent.length === 0) return;
        const section = document.createElement('div');
        section.className = 'category-section';
        section.innerHTML = `<div class="category-header"><h2 class="category-title">${categoryName}</h2><a href="#" class="see-all">See All</a></div><div class="content-slider"></div>`;
        const slider = section.querySelector('.content-slider');
        categoryContent.slice(0, 10).forEach(item => slider.appendChild(createContentCard(item)));
        section.querySelector('.see-all').onclick = (e) => { e.preventDefault(); showCategoryPage(categoryName); };
        container.appendChild(section);
      });
    }

    function updateSlider() {
      const slider = document.getElementById('slider'), indicators = document.getElementById('slider-indicators'), sliderContainer = document.querySelector('.slider-container');
      slider.innerHTML = ''; indicators.innerHTML = '';
      const sliderItems = allContent.filter(item => item.slider === 'on');
      if (sliderItems.length === 0) {
          sliderContainer.style.display = 'none';
          if (sliderInterval) clearInterval(sliderInterval);
          return;
      }
      sliderContainer.style.display = 'block';
      sliderItems.forEach((item, index) => {
        const slide = document.createElement('div');
        slide.className = 'slide';
        slide.innerHTML = `<img src="${item.backdrop}" alt="" onerror="this.style.display='none'"><div class="slide-overlay"><div class="slide-title">${item.title}</div><div class="slide-meta"><span>${item.year || ''}</span><span class="slide-rating"><i class="fas fa-star"></i> ${item.rating || ''}</span></div></div>`;
        slide.onclick = () => showDetailPage(item);
        slider.appendChild(slide);
        const indicator = document.createElement('div');
        indicator.className = `indicator ${index === 0 ? 'active' : ''}`;
        indicator.onclick = () => goToSlide(index);
        indicators.appendChild(indicator);
      });
      startSlider();
    }

    function goToSlide(index) {
      currentSlide = index;
      document.getElementById('slider').style.transform = `translateX(-${currentSlide * 100}%)`;
      document.querySelectorAll('.indicator').forEach((ind, i) => ind.classList.toggle('active', i === currentSlide));
    }

    function startSlider() {
      if (sliderInterval) clearInterval(sliderInterval);
      sliderInterval = setInterval(() => {
        const slides = document.querySelectorAll('#slider .slide'); if (slides.length === 0) return;
        currentSlide = (currentSlide + 1) % slides.length;
        goToSlide(currentSlide);
      }, 5000);
    }

    // START: Updated Universal Video Player
    function openVideoPlayer(url) {
        if (!url) {
            console.error("Video URL is invalid.");
            showToast('Video link is not available.', 'error');
            return;
        }

        const playerContainer = document.getElementById('video-player');
        const iframePlayer = document.getElementById('iframe-player');
        const nativePlayer = document.getElementById('native-player');
        
        iframePlayer.style.display = 'none';
        nativePlayer.style.display = 'none';

        const iframePlayerDomains = ['livereacting.com', 'anym3u8player.com', 'hlsplayer.net', 'player.autoembed.cc', 'player.vidify.top'];
        const directFileExtensions = ['.mkv', '.mp4', '.webm', '.mov', '.avi', '.flv', '.m3u8', '.ts'];
        const directFileDomains = ['pixeldrain.dev', 'ftpbd.net', 'sarail.net', 'ydns.eu', 'discoveryftp.net'];
        
        let useNativePlayer = false;

        try {
            const urlObject = new URL(url);
            const hostname = urlObject.hostname.toLowerCase();
            const pathname = urlObject.pathname.toLowerCase();

            if (iframePlayerDomains.some(domain => hostname.includes(domain))) {
                useNativePlayer = false;
            } else if (directFileExtensions.some(ext => pathname.endsWith(ext))) {
                useNativePlayer = true;
            } else if (directFileDomains.some(domain => hostname.includes(domain))) {
                useNativePlayer = true;
            } else {
                useNativePlayer = false;
            }
        } catch (e) {
            const lowerUrl = url.toLowerCase();
            useNativePlayer = directFileExtensions.some(ext => lowerUrl.endsWith(ext));
        }
        
        if (useNativePlayer) {
            nativePlayer.src = url;
            nativePlayer.style.display = 'block';
            if(nativePlayer.paused) nativePlayer.play();
        } else {
            iframePlayer.src = url;
            iframePlayer.style.display = 'block';
        }

        playerContainer.style.display = 'block';
    }

    function closeVideoPlayer() {
        const playerContainer = document.getElementById('video-player');
        const iframePlayer = document.getElementById('iframe-player');
        const nativePlayer = document.getElementById('native-player');
        
        playerContainer.style.display = 'none';
        iframePlayer.src = 'about:blank';
        
        if (!nativePlayer.paused) {
            nativePlayer.pause();
        }
        nativePlayer.src = '';
        nativePlayer.removeAttribute('src');
        try {
          nativePlayer.load();
        } catch(e) { /* Ignore error */ }
    }
    // END: Updated Universal Video Player

    function playContent() {
      show_9731188().then(() => {
        if (!currentContent) return;
        let videoUrl = (currentContent.type === 'movie') ? currentContent.link : currentContent.episodes?.[0]?.link;
        if (videoUrl) openVideoPlayer(videoUrl);
        else showToast('No content to play', 'error');
      });
    }

    function playEpisode(link) {
      show_9731188().then(() => {
        if (link) openVideoPlayer(link);
        else showToast('Link is missing.', 'error');
      });
    }
    
    function showLiveTVPlayerPage(channel) {
        if (!channel || !channel.link) {
            showToast('Channel link is missing!', 'error');
            return;
        }
        
        showPage('livetv-player-page');

        const player = document.getElementById('livetv-iframe-player');
        player.src = channel.link;

        document.getElementById('current-channel-logo').src = channel.poster;
        document.getElementById('current-channel-title').textContent = channel.title;

        const grid = document.getElementById('other-channels-grid');
        grid.innerHTML = '';
        const otherChannels = liveTVCache.filter(c => c.id !== channel.id);
        otherChannels.forEach(otherChannel => {
            grid.appendChild(createLiveTVGridCard(otherChannel));
        });
        
        window.scrollTo(0, 0);
    }

    function searchContent() {
      const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
      const mainContentContainer = document.getElementById('main-content-container');
      const searchContainer = document.getElementById('search-results-container');
      
      if (!searchTerm) {
        searchContainer.style.display = 'none'; 
        mainContentContainer.style.display = 'block'; 
        return;
      }

      const filteredContent = allContent.filter(item => (item.title||'').toLowerCase().includes(searchTerm));
      searchContainer.innerHTML = '';
      const section = document.createElement('div');
      section.className = 'category-section';
      section.innerHTML = `<div class="category-header"><h2 class="category-title">Search Results</h2></div><div class="content-grid"></div>`;
      const grid = section.querySelector('.content-grid');

      if (filteredContent.length > 0) {
        filteredContent.forEach(item => grid.appendChild(createContentCard(item)));
      } else {
        grid.innerHTML = `<p style="padding: 20px 15px; color: #aaa; grid-column: 1 / -1; text-align: center;">No results found for "${searchTerm}"</p>`;
      }
      
      searchContainer.appendChild(section);
      mainContentContainer.style.display = 'none'; 
      searchContainer.style.display = 'block';
    }

    function toggleSidebar() {
        document.getElementById('sidebar-menu').classList.toggle('active');
        document.getElementById('sidebar-overlay').classList.toggle('active');
    }

    function showContentListPage(type, title) {
        document.getElementById('content-list-title').textContent = title;
        const grid = document.getElementById('content-list-grid');
        grid.innerHTML = '';
        
        let contentToShow = [];
        if (type === 'movie') contentToShow = moviesCache;
        else if (type === 'webseries') contentToShow = webseriesCache;

        if (contentToShow.length > 0) {
            contentToShow.forEach(item => grid.appendChild(createContentCard(item)));
        }
        showPage('content-list-page');
    }

    function renderSidebarMenu() {
        const container = document.getElementById('sidebar-nav-container');
        if (!container) return;
        
        container.innerHTML = '';

        const mainMenuItems = ['live tv', 'movies', 'web series', 'home'];
        
        const uniqueCategories = [...new Set(categories)];
        const filteredCategories = uniqueCategories.filter(cat => 
            !mainMenuItems.includes(cat.toLowerCase())
        );
        
        let categoriesHTML = filteredCategories.map(cat => 
            `<a href="#" onclick="showCategoryPage('${cat}'); toggleSidebar();">${cat}</a>`
        ).join('');

        container.innerHTML = `
            <a href="#" onclick="showPage('home-page'); toggleSidebar();">Home</a>
            <a href="#" onclick="showContentListPage('movie', 'All Movies'); toggleSidebar();">Movies</a>
            <a href="#" onclick="showContentListPage('webseries', 'All Series'); toggleSidebar();">Web Series</a>
            <a href="#" onclick="showLiveTVPage(); toggleSidebar();">Live TV</a>
            <h3>Categories</h3>
            ${categoriesHTML}
        `;
    }
  </script>
</body>
</html>
